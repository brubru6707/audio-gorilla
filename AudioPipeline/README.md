# AudioPipeline

Generate speech audio files from text prompts using AI voice providers (ElevenLabs, Hume.ai) with optional background audio overlay.

## Features

- **Text-to-Speech**: Convert text prompts to speech using ElevenLabs or Hume.ai APIs
- **Background Audio**: Automatically overlay random background audio tracks
- **Volume Control**: Background audio is automatically quieter than speech (-20dB by default)
- **Fallback Support**: Falls back to Google TTS if API calls fail
- **Random Selection**: Randomly selects voices and background tracks for variety

## Installation

```bash
pip install -r requirements.txt
```

## Environment Variables (Optional)

- `HUME_API_KEY` and `HUME_SECRET_KEY`
- `ELEVENLABS_API_KEY`
- `AUDIO_OUTPUT_DIR` (default: `generated_audio`)

## Usage

### Basic Usage

```bash
python -m AudioPipeline.voice_pipeline prompts.json
```

### With Custom Background Volume

```bash
python -m AudioPipeline.voice_pipeline prompts.json --background-volume -15.0
```

### Without Background Audio

```bash
python -m AudioPipeline.voice_pipeline prompts.json --no-background
```

## Input Format

Create JSON files with the following structure:

```json
[
  {
    "text": "Hello, this is a demo generated by the audio pipeline.",
    "filename": "demo_hello.mp3",
    "folder": "demo_outputs"
  },
  {
    "text": "This pipeline supports multiple voice providers and random voice selection.",
    "filename": "demo_multi_provider.mp3",
    "folder": "demo_outputs"
  }
]
```

### Fields

- `text` (required): The phrase to speak
- `filename` (optional): Output filename (default: random)
- `folder` (optional): Destination directory (default: `AUDIO_OUTPUT_DIR`)

## Background Audio

The pipeline automatically adds background audio to each generated speech file:

- **Random Selection**: Chooses a random background track from `AudioPipeline/background/`
- **Volume Control**: Background is 20dB quieter than speech by default
- **Length Matching**: Automatically loops or segments background to match speech duration
- **Format Support**: Works with WAV, MP3, M4A, FLAC, and OGG files

## Dependencies

- `requests`: For API calls
- `gTTS`: Fallback text-to-speech
- `pydub`: Audio processing (requires FFmpeg for full functionality)
- `librosa`: Audio analysis and processing
- `numpy`: Numerical operations
- `soundfile`: Audio file I/O

## Troubleshooting

### FFmpeg Warning
If you see FFmpeg warnings, the pipeline will still work using librosa for basic audio operations. For full functionality, install FFmpeg:

**Windows:**
```bash
# Using chocolatey
choco install ffmpeg

# Or download from https://ffmpeg.org/download.html
```

**macOS:**
```bash
brew install ffmpeg
```

**Linux:**
```bash
sudo apt install ffmpeg
```

### API Errors
The pipeline gracefully handles API failures by falling back to Google TTS, ensuring audio generation always succeeds.

## Example Output

Each run generates:
- Speech audio files with random voices
- Background audio overlay (city sounds, rain, coffee shop, etc.)
- Properly balanced volume levels
- Files saved to specified directories

The pipeline creates engaging, professional-sounding audio content suitable for various applications.
